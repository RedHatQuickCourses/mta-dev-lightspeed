<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 4: Deploying the Migrated App on JBoss EAP 8 :: Modernizing Java Applications with Red Hat MTA &amp; Developer Lightspeed</title>
    <link rel="prev" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Modernizing Java Applications with Red Hat MTA &amp; Developer Lightspeed</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/mta-dev-lightspeed/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mta-dev-lightspeed" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Modernizing Java Applications with Red Hat MTA &amp; Developer Lightspeed</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter1/index.html">Red Hat Developer Lightspeed for MTA</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Lab Scenario</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Lab 1: Deploying Coolstore on JBoss EAP 7</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Lab 2: Configure MTA with Developer Lightspeed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Lab 3: Migrating legacy code using MTA and Developer Lightspeed</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section4.html">Lab 4: Deploying the Migrated App on JBoss EAP 8</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Modernizing Java Applications with Red Hat MTA &amp; Developer Lightspeed</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Modernizing Java Applications with Red Hat MTA & Developer Lightspeed</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Modernizing Java Applications with Red Hat MTA & Developer Lightspeed</a></li>
    <li><a href="index.html">Lab Scenario</a></li>
    <li><a href="section4.html">Lab 4: Deploying the Migrated App on JBoss EAP 8</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab 4: Deploying the Migrated App on JBoss EAP 8</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you apply the changes to migrate the <strong>Coolstore</strong> application to <strong>Jakarta EE</strong>.
You rebuild the container image using <strong>JBoss EAP 8</strong>, deploy it on OpenShift, and validate that the modernized application functions as expected.</p>
</div>
<div class="paragraph">
<p>This step completes the migration journey, demonstrating how a legacy enterprise Java application can be successfully transformed and redeployed on a modern, supported runtime—without disrupting the underlying container platform.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><em>Prepare and Build the Migrated Application</em></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For the purpose of this lab, you may clone the pre-migrated version of the application, which already includes the required changes to migrate from the javax namespace to the Jakarta EE libraries. This repository is provided to streamline the lab experience and allow you to focus on deployment and validation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>git clone https://github.com/opentraining-labs-customizations/getting-started-migrated.git</strong>

<strong>cd getting-started-migrated</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the directory containing the cloned source code.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>cd getting-started-migrated</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Update the Keycloak configuration to match your Red Hat OpenShift environment. Edit the following file and replace the placeholder &lt;GUID&gt; with your OpenShift cluster identifier.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>vi coolstore/src/main/webapp/keycloak.json</strong>
{
    "realm": "eap",
    "auth-server-url": "https://keycloak-coolstore-eap8.apps.cluster-<strong>&lt;GUID&gt;</strong>.dynamic.redhatworkshops.io/",
    "ssl-required": "external",
    "resource": "eap-app",
    "public-client": true,
    "confidential-port": 0
}</code></pre>
</div>
</div>
</li>
<li>
<p>Build the application using Maven so that the updated configuration is included in the deployable artifact.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>mvn clean package -pl coolstore -am</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the application archive has been successfully generated.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>ls coolstore/target/ROOT.war</strong></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><em>Deploy the updated Coolstore Application on OpenShift (JBoss EAP 8)</em></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the repository that contains the OpenShift resources and deployment configuration for JBoss EAP 8 and copy the newly built application WAR file into the deployment repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>cd mta-dev-lightspeed</strong>

<strong>ls</strong>
eap7_coolstore  eap8_coolstore

cp getting-started-migrated/coolstore/target/ROOT.war eap8_coolstore/00-eap8-coolstore-image</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the image build directory and create the required BuildConfig and ImageStream for JBoss EAP 8.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>cd eap8_coolstore/00-eap8-coolstore-image</strong>

<strong>oc create -f 00-bc-is.yaml</strong>
namespace/coolstore-eap8 created
buildconfig.build.openshift.io/coolstore-eap81 created
imagestream.image.openshift.io/coolstore-eap81 created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the resources have been created successfully.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc project coolstore-eap8</strong>
Now using project "coolstore-eap8" on server "https://api.cluster-6f2l2.dynamic.redhatworkshops.io:6443".

<strong>oc get bc</strong>
NAME              TYPE     FROM     LATEST
coolstore-eap81   Docker   Binary   0

<strong>oc get is</strong>
NAME              IMAGE REPOSITORY                                                                  TAGS   UPDATED
coolstore-eap81   image-registry.openshift-image-registry.svc:5000/coolstore-eap8/coolstore-eap81</code></pre>
</div>
</div>
</li>
<li>
<p>Start a binary build using the copied application artifact.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc start-build coolstore-eap81 --from-dir=. --follow</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Navigate back to the main deployment directory and deploy the PostgreSQL database along with its service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>cd mta-dev-lightspeed/eap8_coolstore</strong>

<strong>oc create -f 01-postgresql-deploy-svc.yaml</strong>
deployment.apps/postgres created
service/postgres created</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the database deployment and service are running.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc get deployment</strong>
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
postgres   1/1     1            1           2m21s

<strong>oc get svc</strong>
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
postgres   ClusterIP   172.31.185.74   &lt;none&gt;        5432/TCP   2m32s</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><em>Configure and Deploy Keycloak</em></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a ConfigMap containing the Keycloak realm configuration.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc create configmap keycloak-realm --from-file=realm-export.json</strong>
configmap/keycloak-realm created

<strong>oc get configmap keycloak-realm</strong>
NAME             DATA   AGE
keycloak-realm   1      20s</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the Keycloak deployment file and replace &lt;GUID&gt; with your OpenShift cluster identifier.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong> vi 02-keyclaok-deploy-svc-route.yaml</strong>
...
            - name: KC_PROXY
              value: edge
            - name: KC_HOSTNAME
              value: keycloak-coolstore-eap8.apps.cluster-&lt;GUID&gt;.dynamic.redhatworkshops.io
            - name: KC_HOSTNAME_STRICT
              value: "false"
            - name: KC_HTTP_ENABLED
              value: "true"
...</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy Keycloak and confirm that all associated resources are created successfully.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc create -f 02-keyclaok-deploy-svc-route.yaml</strong>
imagestream.image.openshift.io/keycloak-rhbk created
deployment.apps/keycloak created
service/keycloak created
route.route.openshift.io/keycloak created
job.batch/keycloak-bootstrap created

<strong>oc get deployment/keycloak</strong>
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
keycloak   1/1     1            1           31s

<strong>oc get svc/keycloak</strong>
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
keycloak   ClusterIP   172.31.102.14   &lt;none&gt;        8080/TCP   42s

<strong>oc get route/keycloak</strong>
NAME       HOST/PORT                                                               PATH   SERVICES   PORT   TERMINATION     WILDCARD
keycloak   keycloak-coolstore-eap8.apps.cluster-6f2l2.dynamic.redhatworkshops.io          keycloak   http   edge/Redirect   None</code></pre>
</div>
</div>
</li>
<li>
<p>Create a job to provision a default Keycloak user (user1 / redhat) required by the application.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc create -f 03-keycloak-job.yaml</strong>
job.batch/keycloak-bootstrap created

<strong>oc get jobs</strong>
NAME                 STATUS     COMPLETIONS   DURATION   AGE
keycloak-bootstrap   Complete   1/1           9s         17s</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><em>Deploy the Coolstore Application</em></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the Coolstore application along with its service and route.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc create -f 04-coolstore.yaml</strong>
deployment.apps/coolstore created
service/coolstore created
route.route.openshift.io/coolstore created</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the application has been deployed successfully and is accessible.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc get deployment/coolstore</strong>
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
coolstore   1/1     1            1           77s

<strong>oc get svc/coolstore</strong>
NAME        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
coolstore   ClusterIP   172.31.133.182   &lt;none&gt;        8080/TCP   89s

<strong>*oc get route/coolstore</strong>
NAME        HOST/PORT                                                                PATH   SERVICES    PORT   TERMINATION   WILDCARD
coolstore   coolstore-coolstore-eap8.apps.cluster-6f2l2.dynamic.redhatworkshops.io          coolstore   8080   edge          None</code></pre>
</div>
</div>
</li>
<li>
<p>Access the application route URL to verify that the legacy application has been successfully deployed and is running.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/image4.png" alt="image4">
</div>
</div>
</li>
<li>
<p>Validate the Keycloak integration by clicking the <strong>Sign In</strong> button on the application landing page.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/image2.png" alt="image2">
</div>
</div>
</li>
<li>
<p>Log in using the credentials <strong>username: user1</strong> and <strong>password: redhat</strong>, and confirm that authentication succeeds and the application is redirected to the main application interface.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/image3.png" alt="image3">
</div>
</div>
<div class="paragraph">
<p><strong>Voilà!</strong> You have successfully migrated the <strong>JBoss EAP 7</strong> application from the legacy <strong>javax-based</strong> codebase to a <strong>JBoss EAP 8</strong> application using the <strong>Jakarta EE</strong> platform.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section3.html">Lab 3: Migrating legacy code using MTA and Developer Lightspeed</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
